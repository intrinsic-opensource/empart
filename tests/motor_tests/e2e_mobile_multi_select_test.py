# Copyright 2025 Intrinsic Innovation LLC

"""
End-to-end test for mobile multi-select functionality in the interactive viewer.
"""
import pytest
from playwright.sync_api import Page


def test_recording(page: Page):
    page.set_viewport_size({'width': 1567, 'height': 894})
    logs: list[str] = []
    page.on("console", lambda m: logs.append(m.text))
    page.on("console", lambda m: print("[console]", m.text))
    page.goto("http://localhost:5004/?e2e", wait_until="domcontentloaded")
    page.wait_for_timeout(3000)  # initial settle
    page.mouse.move(423.930, 561.117)
    page.mouse.move(133.103, 698.255)
    page.mouse.move(114.188, 710.077)
    page.mouse.move(134.955, 714.806)
    page.mouse.move(199.622, 790.368)
    page.mouse.move(5.955, 15.474)
    page.mouse.down()
    page.mouse.up()
    page.get_by_test_id("default-coarseness-slider-increment").click()
    page.mouse.move(5.955, 15.474)
    page.mouse.down()
    page.mouse.up()
    page.get_by_test_id("default-coarseness-slider-increment").click()
    page.mouse.move(209.080, 788.004)
    page.mouse.move(216.173, 747.808)
    page.mouse.move(225.631, 709.977)
    page.mouse.move(249.275, 655.595)
    page.mouse.move(275.284, 617.764)
    page.mouse.move(310.751, 579.933)
    page.mouse.move(360.404, 539.737)
    page.mouse.move(462.075, 464.075)
    page.mouse.move(537.737, 409.693)
    page.mouse.move(627.586, 352.946)
    page.mouse.move(717.435, 308.022)
    page.mouse.move(804.920, 274.919)
    page.mouse.move(946.786, 225.266)
    page.mouse.move(1029.542, 194.528)
    page.mouse.move(1093.382, 170.884)
    page.mouse.move(1164.315, 137.782)
    page.mouse.move(1249.435, 104.679)
    page.mouse.move(1291.995, 90.493)
    page.mouse.move(1322.733, 76.306)
    page.mouse.move(1355.835, 62.119)
    page.mouse.move(1388.938, 43.204)
    page.mouse.move(1411.143, 36.111)
    page.mouse.move(1394.592, 64.897)
    page.mouse.move(1373.312, 86.177)
    page.mouse.move(1355.835, 99.851)
    page.mouse.move(1.747, 2.422)
    page.mouse.down()
    page.mouse.up()
    page.get_by_test_id("btn-run").click()
    page.mouse.move(1351.107, 104.580)
    page.mouse.move(1344.013, 130.490)
    page.mouse.move(1329.827, 147.454)
    page.mouse.move(1315.640, 166.370)
    page.mouse.move(1301.453, 183.847)
    page.mouse.move(1287.779, 202.762)
    page.mouse.move(1257.554, 212.220)
    page.mouse.move(1236.274, 214.584)
    page.mouse.move(1215.507, 219.313)
    if any("Hulls: 3" in t for t in logs):
            pass
    else:
        page.wait_for_event("console", lambda m: "Hulls: 3" in m.text, timeout=100_000)
    assert any("Hulls: 3" in t for t in logs)
    page.mouse.move(1196.178, 231.135)
    page.mouse.move(1177.263, 238.229)
    page.mouse.move(1144.161, 247.687)
    page.mouse.move(1122.880, 252.415)
    page.mouse.move(1081.759, 261.873)
    page.mouse.move(1039.199, 273.695)
    page.mouse.move(999.003, 283.153)
    page.mouse.move(965.901, 290.246)
    page.mouse.move(939.992, 299.704)
    page.mouse.move(916.860, 311.526)
    page.mouse.move(907.402, 313.891)
    page.mouse.down()
    page.mouse.up()
    page.wait_for_timeout(100)
    assert logs, 'no console logs captured'
    assert any("Selected hull → hull-nonSelect-0" in t for t in logs)
    page.mouse.move(907.402, 317.181)
    page.mouse.move(905.037, 350.283)
    page.mouse.move(902.673, 376.292)
    page.mouse.move(900.309, 397.572)
    page.mouse.move(883.758, 388.627)
    page.mouse.down()
    page.mouse.up()
    page.wait_for_timeout(100)
    assert logs, 'no console logs captured'
    assert any("Deselected hull → hull-nonSelect-0" in t for t in logs)
    page.mouse.move(886.122, 391.917)
    page.mouse.move(895.580, 417.414)
    page.mouse.move(897.944, 446.713)
    page.mouse.move(895.580, 483.106)
    page.mouse.move(890.851, 517.134)
    page.mouse.move(886.122, 539.753)
    page.mouse.move(883.758, 549.211)
    page.mouse.down()
    page.mouse.up()
    page.wait_for_timeout(100)
    assert logs, 'no console logs captured'
    assert any("Selected hull → hull-nonSelect-2" in t for t in logs)
    page.mouse.move(883.758, 549.211)
    page.mouse.down()
    page.mouse.up()
    page.wait_for_timeout(100)
    assert logs, 'no console logs captured'
    assert any("Deselected hull → hull-nonSelect-2" in t for t in logs)
    page.mouse.move(879.029, 552.501)
    page.mouse.move(848.291, 585.603)
    page.mouse.move(819.918, 609.248)
    page.mouse.move(793.909, 632.892)
    page.mouse.move(765.535, 654.172)
    page.mouse.move(739.526, 675.452)
    page.mouse.move(715.882, 689.639)
    page.mouse.move(701.282, 708.554)
    page.mouse.move(681.027, 710.919)
    page.mouse.move(659.334, 710.919)
    page.mouse.move(659.334, 710.918)
    page.mouse.down()
    page.mouse.up()
    page.wait_for_timeout(100)
    assert logs, 'no console logs captured'
    assert any("Selected hull → hull-nonSelect-1" in t for t in logs)
    page.mouse.move(659.334, 715.647)
    page.mouse.move(659.334, 715.647)
    page.mouse.down()
    page.mouse.up()
    page.wait_for_timeout(100)
    assert logs, 'no console logs captured'
    assert any("Deselected hull → hull-nonSelect-1" in t for t in logs)
    page.mouse.move(659.334, 713.283)
    page.mouse.move(671.156, 693.028)
    page.mouse.move(649.876, 709.579)
    page.mouse.move(618.213, 723.766)
    page.mouse.move(575.653, 740.317)
    page.mouse.move(528.364, 759.232)
    page.mouse.move(466.888, 780.512)
    page.mouse.move(393.591, 804.157)
    page.mouse.move(296.648, 832.530)
    page.mouse.move(244.631, 846.717)
    page.mouse.move(180.791, 860.903)
    page.mouse.move(138.231, 867.997)
    page.mouse.move(90.942, 875.090)
    page.mouse.move(69.662, 877.454)
    page.mouse.move(46.530, 879.819)
    page.mouse.move(24.836, 879.819)
    page.mouse.move(27.201, 856.174)
    page.mouse.move(9.568, 7.778)
    page.mouse.down()
    page.mouse.up()
