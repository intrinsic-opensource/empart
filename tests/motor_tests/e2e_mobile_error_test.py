# Copyright 2025 Intrinsic Innovation LLC

"""
End-to-end test for mobile error handling in the interactive viewer.
"""

import pytest
from playwright.sync_api import Page


def test_recording(page: Page):
    page.set_viewport_size({'width': 1567, 'height': 894})
    logs: list[str] = []
    page.on("console", lambda m: logs.append(m.text))
    page.on("console", lambda m: print("[console]", m.text))
    page.goto("http://localhost:5004/?e2e", wait_until="domcontentloaded")
    page.wait_for_timeout(3000)  # initial settle
    page.mouse.move(1416.667, 11.667)
    page.mouse.move(1437.723, 32.609)
    page.mouse.move(1456.638, 58.618)
    page.mouse.move(1469.642, 81.080)
    page.mouse.move(1486.193, 117.729)
    page.mouse.move(1492.105, 140.191)
    page.mouse.move(1495.651, 170.929)
    page.mouse.move(1495.651, 195.755)
    page.mouse.move(1485.011, 247.773)
    page.mouse.move(1474.371, 271.418)
    page.mouse.move(1454.274, 296.244)
    page.mouse.move(1432.994, 317.524)
    page.mouse.move(1397.527, 339.987)
    page.mouse.move(1349.056, 358.902)
    page.mouse.move(1308.860, 369.542)
    page.mouse.move(1279.305, 376.635)
    page.mouse.move(1252.114, 383.729)
    page.mouse.move(1208.372, 396.733)
    page.mouse.move(1169.358, 407.373)
    page.mouse.move(1143.349, 416.831)
    page.mouse.move(1126.798, 431.017)
    page.mouse.move(1112.612, 454.406)
    page.mouse.move(1097.243, 470.700)
    page.mouse.move(1078.840, 484.887)
    page.mouse.move(1057.560, 493.162)
    page.mouse.move(1040.083, 503.802)
    page.mouse.move(1028.261, 522.461)
    page.mouse.move(1016.439, 546.106)
    page.mouse.move(1004.617, 566.204)
    page.mouse.move(988.066, 592.212)
    page.mouse.move(986.883, 618.221)
    page.mouse.move(1001.070, 640.683)
    page.mouse.move(1018.803, 658.417)
    page.mouse.move(1041.265, 677.332)
    page.mouse.move(1064.141, 691.519)
    page.mouse.move(1066.505, 695.066)
    page.mouse.down()
    page.mouse.move(1066.5, 695.1)
    page.mouse.down()
    page.mouse.move(1114.7, 686.8, steps=2)
    page.mouse.up()
    page.mouse.move(1114.720, 686.790)
    page.mouse.up()
    page.mouse.move(1112.355, 686.790)
    page.mouse.move(1087.529, 689.154)
    page.mouse.move(1067.431, 689.154)
    page.mouse.move(1020.142, 689.154)
    page.mouse.move(964.578, 686.790)
    page.mouse.move(944.480, 686.790)
    page.mouse.move(905.467, 685.608)
    page.mouse.move(873.547, 684.426)
    page.mouse.move(810.889, 682.061)
    page.mouse.move(778.969, 679.697)
    page.mouse.move(737.591, 676.150)
    page.mouse.move(706.853, 672.603)
    page.mouse.move(663.111, 667.875)
    page.mouse.move(630.009, 664.328)
    page.mouse.move(598.089, 658.417)
    page.mouse.move(587.705, 639.758)
    page.mouse.move(587.705, 626.753)
    page.mouse.down()
    page.mouse.move(587.7, 626.8)
    page.mouse.down()
    page.mouse.move(764.9, 585.9, steps=9)
    page.mouse.up()
    page.mouse.move(764.939, 585.888)
    page.mouse.up()
    page.mouse.move(764.939, 584.706)
    page.mouse.move(783.855, 568.411)
    page.mouse.move(813.410, 545.949)
    page.mouse.move(838.237, 524.669)
    page.mouse.move(876.068, 489.202)
    page.mouse.move(897.348, 471.469)
    page.mouse.move(919.810, 456.100)
    page.mouse.move(950.548, 433.638)
    page.mouse.move(970.646, 415.905)
    page.mouse.move(991.926, 394.625)
    page.mouse.move(1006.112, 378.330)
    page.mouse.move(1002.822, 358.075)
    page.mouse.move(984.932, 341.524)
    page.mouse.move(973.622, 323.791)
    page.mouse.move(953.781, 320.244)
    page.mouse.move(950.234, 319.062)
    page.mouse.down()
    page.mouse.move(950.2, 319.1)
    page.mouse.down()
    page.mouse.move(1042.7, 336.4, steps=4)
    page.mouse.up()
    page.mouse.move(1042.703, 336.382)
    page.mouse.up()
    page.mouse.move(1041.521, 336.382)
    page.mouse.move(1022.035, 351.751)
    page.mouse.move(994.844, 363.573)
    page.mouse.move(953.466, 381.306)
    page.mouse.move(928.639, 393.128)
    page.mouse.move(890.808, 410.862)
    page.mouse.move(845.884, 429.777)
    page.mouse.move(799.777, 447.511)
    page.mouse.move(725.297, 472.337)
    page.mouse.move(670.915, 490.071)
    page.mouse.move(617.715, 510.169)
    page.mouse.move(564.515, 529.084)
    page.mouse.move(488.853, 556.275)
    page.mouse.move(440.382, 575.191)
    page.mouse.move(403.733, 590.560)
    page.mouse.move(367.084, 607.111)
    page.mouse.move(332.800, 623.662)
    page.mouse.move(293.786, 643.760)
    page.mouse.move(270.142, 654.400)
    page.mouse.move(250.044, 665.039)
    page.mouse.move(232.311, 674.497)
    page.mouse.move(215.760, 686.319)
    page.mouse.move(201.573, 705.235)
    page.mouse.move(199.208, 731.401)
    page.mouse.move(193.297, 754.533)
    page.mouse.move(181.732, 771.911)
    page.mouse.move(210.105, 776.383)
    page.mouse.move(240.843, 771.654)
    page.mouse.move(284.585, 761.014)
    page.mouse.move(311.776, 755.103)
    page.mouse.move(333.469, 752.739)
    page.mouse.move(359.222, 750.374)
    page.mouse.move(392.324, 749.192)
    page.mouse.move(414.786, 749.192)
    page.mouse.move(426.096, 748.010)
    page.mouse.down(button='right')
    page.mouse.move(426.096, 748.010)
    page.mouse.up(button='right')
    page.mouse.move(423.732, 748.010)
    page.mouse.move(403.064, 748.010)
    page.mouse.move(380.188, 749.192)
    page.mouse.move(360.090, 750.374)
    page.mouse.move(338.810, 750.374)
    page.mouse.move(317.530, 750.374)
    page.mouse.move(286.793, 750.374)
    page.mouse.move(265.513, 750.374)
    page.mouse.move(234.775, 744.463)
    page.mouse.move(218.480, 732.641)
    page.mouse.move(226.755, 713.312)
    page.mouse.move(225.573, 737.370)
    page.mouse.move(225.573, 759.832)
    page.mouse.move(225.573, 785.841)
    page.mouse.move(225.573, 805.939)
    page.mouse.move(226.755, 828.145)
    page.mouse.move(17.791, 9.903)
    page.mouse.down()
    page.mouse.move(17.791, 9.903)
    page.mouse.up()
    page.get_by_test_id("box-0-coarseness-slider-increment").click()
    page.mouse.move(17.791, 9.903)
    page.mouse.down()
    page.mouse.move(17.791, 9.903)
    page.mouse.up()
    page.get_by_test_id("box-0-coarseness-slider-increment").click()
    page.mouse.move(17.791, 9.903)
    page.mouse.down()
    page.mouse.move(17.791, 9.903)
    page.mouse.up()
    page.get_by_test_id("box-0-coarseness-slider-increment").click()
    page.mouse.move(231.484, 833.287)
    page.mouse.move(248.035, 819.357)
    page.mouse.move(295.324, 790.983)
    page.mouse.move(328.427, 773.250)
    page.mouse.move(388.720, 741.330)
    page.mouse.move(408.818, 731.872)
    page.mouse.move(482.115, 696.406)
    page.mouse.move(560.142, 652.663)
    page.mouse.move(620.435, 611.285)
    page.mouse.move(651.173, 588.823)
    page.mouse.move(692.551, 562.814)
    page.mouse.move(749.298, 530.894)
    page.mouse.move(785.947, 503.703)
    page.mouse.move(815.502, 472.966)
    page.mouse.move(829.689, 458.779)
    page.mouse.move(845.471, 442.484)
    page.mouse.move(862.948, 428.297)
    page.mouse.move(875.696, 412.929)
    page.mouse.down(button='right')
    page.mouse.move(875.696, 412.929)
    page.mouse.up(button='right')
    page.mouse.move(873.588, 414.111)
    page.mouse.move(841.668, 427.115)
    page.mouse.move(784.921, 448.395)
    page.mouse.move(726.992, 469.675)
    page.mouse.move(672.610, 489.773)
    page.mouse.move(570.939, 527.604)
    page.mouse.move(517.739, 551.249)
    page.mouse.move(469.268, 574.893)
    page.mouse.move(413.703, 606.813)
    page.mouse.move(366.414, 635.186)
    page.mouse.move(346.317, 648.191)
    page.mouse.move(327.401, 661.195)
    page.mouse.move(300.210, 694.297)
    page.mouse.move(276.566, 726.217)
    page.mouse.move(257.650, 749.861)
    page.mouse.move(249.375, 779.417)
    page.mouse.move(245.828, 802.036)
    page.mouse.move(234.006, 822.134)
    page.mouse.move(11.367, 10.377)
    page.mouse.down()
    page.mouse.move(11.367, 10.377)
    page.mouse.up()
    page.get_by_test_id("box-1-coarseness-slider-increment").click()
    page.mouse.move(11.367, 10.377)
    page.mouse.down()
    page.mouse.move(11.367, 10.377)
    page.mouse.up()
    page.get_by_test_id("box-1-coarseness-slider-increment").click()
    page.mouse.move(223.878, 835.138)
    page.mouse.move(11.367, 11.559)
    page.mouse.down()
    page.mouse.move(11.4, 11.6)
    page.mouse.down()
    page.mouse.move(12.5, 11.6, steps=2)
    page.mouse.up()
    page.mouse.move(12.550, 11.559)
    page.mouse.up()
    page.get_by_test_id("box-1-coarseness-slider-increment").click()
    page.mouse.move(225.061, 836.320)
    page.mouse.move(246.084, 825.680)
    page.mouse.move(275.640, 802.036)
    page.mouse.move(301.649, 781.938)
    page.mouse.move(338.297, 752.383)
    page.mouse.move(369.035, 722.827)
    page.mouse.move(403.320, 684.996)
    page.mouse.move(438.786, 645.983)
    page.mouse.move(512.084, 573.867)
    page.mouse.move(573.560, 517.121)
    page.mouse.move(642.129, 458.010)
    page.mouse.move(726.066, 392.987)
    page.mouse.move(805.275, 336.241)
    page.mouse.move(897.489, 274.765)
    page.mouse.move(938.867, 252.303)
    page.mouse.move(1015.711, 221.565)
    page.mouse.move(1058.271, 206.196)
    page.mouse.move(1099.649, 192.010)
    page.mouse.move(1139.844, 180.187)
    page.mouse.move(1159.942, 174.276)
    page.mouse.move(1201.320, 164.819)
    page.mouse.move(1253.338, 150.632)
    page.mouse.move(1287.622, 139.992)
    page.mouse.move(1311.267, 131.716)
    page.mouse.move(1334.911, 119.894)
    page.mouse.move(1348.841, 105.038)
    page.mouse.move(1361.846, 88.999)
    page.mouse.move(52.619, 24.145)
    page.mouse.down()
    page.mouse.move(52.619, 24.145)
    page.mouse.up()
    page.get_by_test_id("btn-run").click()
    page.mouse.move(1371.304, 80.980)
    page.mouse.move(1374.850, 101.392)
    if any("Hulls: 16" in t for t in logs):
            pass
    else:
        page.wait_for_event("console", lambda m: "Hulls: 16" in m.text, timeout=100_000)
    assert any("Hulls: 16" in t for t in logs)
    page.mouse.move(25.490, 3.475)
    page.mouse.down()
    page.mouse.move(25.490, 3.475)
    page.mouse.up()
    page.get_by_test_id("btn-run-error-on-approx").click()
    page.mouse.move(1374.850, 103.756)
    page.mouse.move(1374.850, 124.524)
    page.mouse.move(1366.575, 145.448)
    page.mouse.move(1351.206, 166.885)
    page.mouse.move(1326.379, 210.628)
    page.mouse.move(1306.281, 239.001)
    page.mouse.move(1287.366, 263.828)
    page.mouse.move(1266.086, 293.383)
    page.mouse.move(1232.984, 335.943)
    page.mouse.move(1199.882, 383.232)
    page.mouse.move(1164.415, 429.339)
    page.mouse.move(1137.224, 462.441)
    page.mouse.move(1107.668, 499.090)
    page.mouse.move(1079.295, 531.010)
    page.mouse.move(1055.650, 554.654)
    page.mouse.move(1035.552, 571.205)
    page.mouse.move(1013.090, 588.939)
    page.mouse.move(988.264, 611.401)
    page.mouse.move(938.610, 652.779)
    page.mouse.move(905.508, 675.241)
    page.mouse.move(872.406, 695.338)
    page.mouse.move(840.486, 709.525)
    page.mouse.move(806.201, 718.983)
    page.mouse.move(757.730, 731.987)
    page.mouse.move(723.446, 740.263)
    page.mouse.move(692.708, 747.356)
    page.mouse.move(659.606, 753.267)
    page.mouse.move(607.588, 761.543)
    page.mouse.move(581.579, 765.089)
    page.mouse.move(546.112, 771.000)
    page.mouse.move(520.103, 776.911)
    page.mouse.move(489.366, 785.187)
    page.mouse.move(466.903, 792.280)
    page.mouse.move(445.623, 798.191)
    page.mouse.move(424.343, 805.285)
    page.mouse.move(382.965, 821.836)
    page.mouse.move(346.317, 831.293)
    page.mouse.move(310.850, 838.387)
    page.mouse.move(284.841, 844.298)
    page.mouse.move(258.832, 847.844)
    if any("Process Error completed" in t for t in logs):
            pass
    else:
        page.wait_for_event("console", lambda m: "Process Error completed" in m.text, timeout=120_000)
    assert any("Process Error completed" in t for t in logs)
    page.mouse.move(214.933, 853.756)
    page.mouse.move(191.288, 853.756)
    page.mouse.move(136.906, 857.302)
    page.mouse.move(113.518, 858.484)
    page.mouse.move(93.263, 858.484)
    page.mouse.move(69.719, 12.196)
    page.mouse.down()
    page.mouse.move(69.719, 12.196)
    page.mouse.up()
