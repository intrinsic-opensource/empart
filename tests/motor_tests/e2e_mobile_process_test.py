# Copyright 2025 Intrinsic Innovation LLC

"""
End-to-end test for clicking and moving and drawing a box and then processing in the interactive viewer.
"""

import pytest
from playwright.sync_api import Page


def test_recording(page: Page):
    page.set_viewport_size({'width': 1567, 'height': 894})
    logs: list[str] = []
    page.on("console", lambda m: logs.append(m.text))
    page.on("console", lambda m: print("[console]", m.text))
    page.goto("http://localhost:5004/?e2e", wait_until="domcontentloaded")
    page.wait_for_timeout(3000)  # initial settle
    page.mouse.move(473.715, 3.159)
    page.mouse.move(569.219, 1.464)
    page.mouse.move(563.308, 28.655)
    page.mouse.move(678.140, 399.617)
    page.mouse.move(661.589, 419.715)
    page.mouse.move(637.945, 439.812)
    page.mouse.move(610.754, 455.181)
    page.mouse.move(574.105, 469.368)
    page.mouse.move(544.549, 489.466)
    page.mouse.move(554.007, 607.745)
    page.mouse.move(583.563, 625.478)
    page.mouse.move(614.301, 644.394)
    page.mouse.move(637.945, 658.581)
    page.mouse.move(655.679, 668.038)
    page.mouse.move(681.688, 679.860)
    page.mouse.move(734.887, 699.958)
    page.mouse.move(762.078, 708.234)
    page.mouse.move(782.176, 712.963)
    page.mouse.move(815.279, 718.874)
    page.mouse.move(850.745, 722.420)
    page.mouse.move(887.394, 722.420)
    page.mouse.move(931.136, 717.691)
    page.mouse.move(961.874, 708.234)
    page.mouse.move(980.790, 698.776)
    page.mouse.move(1015.074, 668.038)
    page.mouse.move(1029.260, 637.301)
    page.mouse.move(1039.901, 617.459)
    page.mouse.move(1062.264, 609.696)
    page.mouse.move(1083.287, 614.425)
    page.mouse.move(1088.686, 634.581)
    page.mouse.move(1089.868, 648.668)
    page.mouse.down()
    page.mouse.move(1089.9, 648.7)
    page.mouse.down()
    page.mouse.move(1141.0, 626.2, steps=2)
    page.mouse.up()
    page.mouse.move(1141.018, 626.206)
    page.mouse.up()
    page.mouse.move(1138.653, 626.206)
    page.mouse.move(1108.172, 622.660)
    page.mouse.move(1076.252, 619.113)
    page.mouse.move(1043.150, 614.384)
    page.mouse.move(1019.505, 610.837)
    page.mouse.move(979.310, 603.744)
    page.mouse.move(941.479, 597.833)
    page.mouse.move(891.825, 589.557)
    page.mouse.move(852.812, 584.829)
    page.mouse.move(825.621, 580.100)
    page.mouse.move(797.247, 576.553)
    page.mouse.move(768.874, 571.824)
    page.mouse.move(731.043, 564.731)
    page.mouse.move(705.034, 561.184)
    page.mouse.move(666.021, 557.638)
    page.mouse.move(635.283, 552.909)
    page.mouse.move(612.821, 549.362)
    page.mouse.move(584.447, 544.633)
    page.mouse.move(597.964, 560.002)
    page.mouse.move(597.965, 560.002)
    page.mouse.down()
    page.mouse.move(598.0, 560.0)
    page.mouse.down()
    page.mouse.move(770.1, 548.2, steps=8)
    page.mouse.up()
    page.mouse.move(770.072, 548.180)
    page.mouse.up()
    page.mouse.move(768.890, 548.180)
    page.mouse.move(748.635, 555.273)
    page.mouse.move(725.760, 557.638)
    page.mouse.move(744.005, 545.815)
    page.mouse.move(773.561, 531.629)
    page.mouse.move(792.476, 523.353)
    page.mouse.move(810.210, 512.713)
    page.mouse.move(836.218, 496.162)
    page.mouse.move(859.863, 480.793)
    page.mouse.move(885.872, 464.242)
    page.mouse.move(904.787, 451.238)
    page.mouse.move(943.800, 424.047)
    page.mouse.move(972.174, 403.949)
    page.mouse.move(992.272, 390.944)
    page.mouse.move(1024.192, 369.664)
    page.mouse.move(1045.472, 354.295)
    page.mouse.move(1084.485, 320.011)
    page.mouse.move(1115.223, 292.820)
    page.mouse.move(1136.503, 276.269)
    page.mouse.move(1168.423, 251.442)
    page.mouse.move(1200.343, 227.798)
    page.mouse.move(1228.716, 205.335)
    page.mouse.move(1244.085, 191.149)
    page.mouse.move(1261.819, 172.233)
    page.mouse.move(1281.916, 153.318)
    page.mouse.move(1310.290, 130.855)
    page.mouse.move(1329.205, 116.669)
    page.mouse.move(1351.667, 97.753)
    page.mouse.move(1372.947, 76.473)
    page.mouse.move(1311.728, 107.211)
    page.mouse.move(1270.350, 124.944)
    page.mouse.move(1217.150, 143.860)
    page.mouse.move(1160.404, 160.411)
    page.mouse.move(1100.110, 174.598)
    page.mouse.move(962.972, 202.971)
    page.mouse.move(886.128, 218.340)
    page.mouse.move(855.390, 226.615)
    page.mouse.move(771.452, 250.260)
    page.mouse.move(708.795, 272.722)
    page.mouse.move(598.848, 320.011)
    page.mouse.move(537.372, 349.566)
    page.mouse.move(485.355, 376.758)
    page.mouse.move(445.159, 401.584)
    page.mouse.move(393.141, 445.327)
    page.mouse.move(369.497, 471.335)
    page.mouse.move(343.488, 506.802)
    page.mouse.move(329.301, 529.264)
    page.mouse.move(297.381, 575.371)
    page.mouse.move(280.830, 597.833)
    page.mouse.move(266.644, 617.931)
    page.mouse.move(253.639, 636.846)
    page.mouse.move(239.453, 656.944)
    page.mouse.move(216.990, 681.771)
    page.mouse.move(199.257, 698.322)
    page.mouse.move(185.070, 713.691)
    page.mouse.move(173.248, 729.986)
    page.mouse.move(189.287, 745.098)
    page.mouse.move(205.069, 761.137)
    page.mouse.move(194.685, 781.392)
    page.mouse.move(178.390, 795.578)
    page.mouse.move(161.170, 808.583)
    page.mouse.move(215.296, 799.125)
    page.mouse.move(244.851, 789.667)
    page.mouse.move(282.682, 779.027)
    page.mouse.move(326.424, 766.023)
    page.mouse.move(359.527, 756.565)
    page.mouse.move(396.176, 747.107)
    page.mouse.move(416.273, 741.196)
    page.mouse.move(430.204, 735.285)
    page.mouse.down(button='right')
    page.mouse.move(430.204, 735.285)
    page.mouse.up(button='right')
    page.mouse.move(429.022, 736.467)
    page.mouse.move(403.269, 744.743)
    page.mouse.move(377.260, 750.654)
    page.mouse.move(357.162, 754.201)
    page.mouse.move(333.518, 758.930)
    page.mouse.move(296.869, 766.023)
    page.mouse.move(274.407, 769.569)
    page.mouse.move(253.127, 773.116)
    page.mouse.move(233.029, 779.027)
    page.mouse.move(215.552, 791.775)
    page.mouse.move(220.281, 813.626)
    page.mouse.move(7.770, 4.330)
    page.mouse.down()
    page.mouse.move(7.8, 4.3)
    page.mouse.down()
    page.mouse.move(10.1, 4.3, steps=2)
    page.mouse.up()
    page.mouse.move(10.134, 4.330)
    page.mouse.up()
    page.get_by_test_id("box-0-coarseness-slider-increment").click()
    page.mouse.move(10.134, 4.330)
    page.mouse.down()
    page.mouse.move(10.1, 4.3)
    page.mouse.down()
    page.mouse.move(11.3, 4.3, steps=2)
    page.mouse.up()
    page.mouse.move(11.317, 4.330)
    page.mouse.up()
    page.get_by_test_id("box-0-coarseness-slider-increment").click()
    page.mouse.move(11.317, 4.330)
    page.mouse.down()
    page.mouse.move(11.317, 4.330)
    page.mouse.up()
    page.get_by_test_id("box-0-coarseness-slider-increment").click()
    page.mouse.move(226.192, 825.349)
    page.mouse.move(251.019, 806.433)
    page.mouse.move(268.752, 792.247)
    page.mouse.move(290.032, 772.149)
    page.mouse.move(308.947, 753.233)
    page.mouse.move(338.503, 720.131)
    page.mouse.move(404.707, 655.109)
    page.mouse.move(478.005, 587.722)
    page.mouse.move(573.765, 508.513)
    page.mouse.move(673.072, 447.038)
    page.mouse.move(784.201, 395.020)
    page.mouse.move(853.952, 364.282)
    page.mouse.move(922.521, 333.544)
    page.mouse.move(995.819, 296.896)
    page.mouse.move(1046.654, 268.522)
    page.mouse.move(1108.130, 233.056)
    page.mouse.move(1158.965, 204.682)
    page.mouse.move(1199.161, 184.584)
    page.mouse.move(1268.912, 155.029)
    page.mouse.move(1297.286, 142.024)
    page.mouse.move(1330.388, 126.655)
    page.mouse.move(1352.850, 113.651)
    page.mouse.move(1369.401, 101.829)
    page.mouse.move(1388.317, 81.731)
    page.mouse.move(1402.503, 67.131)
    page.mouse.move(85.000, 5.154)
    page.mouse.down()
    page.mouse.move(85.000, 5.154)
    page.mouse.up()
    page.get_by_test_id("btn-run").click()
    page.mouse.move(1292.557, 249.962)
    page.mouse.move(1279.552, 271.242)
    page.mouse.move(1267.730, 291.340)
    page.mouse.move(1254.726, 314.984)
    page.mouse.move(1242.904, 335.082)
    page.mouse.move(1228.717, 351.534)
    if any("Hulls: 11" in t for t in logs):
            pass
    else:
        page.wait_for_event("console", lambda m: "Hulls: 11" in m.text, timeout=100_000)
    assert any("Hulls: 11" in t for t in logs)
    page.mouse.move(1194.432, 372.557)
    page.mouse.move(1160.148, 393.837)
    page.mouse.move(1109.313, 424.575)
    page.mouse.move(1012.370, 475.411)
    page.mouse.move(910.699, 520.335)
    page.mouse.move(806.664, 560.531)
    page.mouse.move(712.086, 594.815)
    page.mouse.move(551.304, 656.291)
    page.mouse.move(448.450, 690.575)
    page.mouse.move(355.055, 720.131)
    page.mouse.move(294.762, 739.046)
    page.mouse.move(215.553, 768.602)
    page.mouse.move(175.357, 785.153)
    page.mouse.move(133.979, 802.886)
    page.mouse.move(100.877, 819.437)
    page.mouse.move(81.961, 831.259)
    page.mouse.move(55.953, 853.722)
    page.mouse.move(39.401, 865.287)
    page.mouse.move(60.169, 871.198)
    page.mouse.move(87.360, 870.016)
    page.mouse.move(83.657, 24.910)
    page.mouse.down()
    page.mouse.move(83.657, 24.910)
    page.mouse.up()
